(self.webpackChunkfun_doc=self.webpackChunkfun_doc||[]).push([[5197],{5877:(e,l,a)=>{"use strict";a.r(l),a.d(l,{data:()=>r});const r={key:"v-99e603aa",path:"/micro_frontend/qiankun%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%AE%9E%E8%B7%B5.html",title:"qiankun微前端框架实践",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"基本使用",slug:"基本使用",children:[]},{level:2,title:"问题处理",slug:"问题处理",children:[]},{level:2,title:"Other",slug:"other",children:[]},{level:2,title:"参考链接",slug:"参考链接",children:[]},{level:2,title:"拆分项目",slug:"拆分项目",children:[]}],filePathRelative:"micro_frontend/qiankun微前端框架实践.md",git:{updatedTime:163894919e4,contributors:[{name:"caifang",email:"cooldish1245@163.com",commits:2}]}}},264:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>L});var r=a(6252);const n=(0,r.uE)('<h1 id="qiankun微前端框架实践"><a class="header-anchor" href="#qiankun微前端框架实践">#</a> qiankun微前端框架实践</h1><h2 id="基本使用"><a class="header-anchor" href="#基本使用">#</a> 基本使用</h2><h2 id="问题处理"><a class="header-anchor" href="#问题处理">#</a> 问题处理</h2><p>1.子应用的懒加载路由无法找到，子应用的资源(png)等无法找到</p>',4),t=(0,r.Uk)("解决方式："),i={href:"https://qiankun.umijs.org/zh/faq#a-%E4%BD%BF%E7%94%A8-webpack-%E8%BF%90%E8%A1%8C%E6%97%B6-publicpath-%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"},o=(0,r.Uk)("子应用添加__webpack_public_path__赋值"),p=(0,r.Wm)("h2",{id:"other"},[(0,r.Wm)("a",{class:"header-anchor",href:"#other"},"#"),(0,r.Uk)(" Other")],-1),c=(0,r.Wm)("p",null,"1.自定义UI组件的全局注册抽象",-1),h=(0,r.Wm)("p",null,"2.Proxy的使用",-1),s=(0,r.Wm)("h2",{id:"参考链接"},[(0,r.Wm)("a",{class:"header-anchor",href:"#参考链接"},"#"),(0,r.Uk)(" 参考链接")],-1),u={href:"https://github.com/umijs/qiankun",target:"_blank",rel:"noopener noreferrer"},d=(0,r.Uk)("https://github.com/umijs/qiankun"),m={href:"https://qiankun.umijs.org/zh/guide/getting-started",target:"_blank",rel:"noopener noreferrer"},f=(0,r.Uk)("https://qiankun.umijs.org/zh/guide/getting-started"),b={href:"https://single-spa.js.org/",target:"_blank",rel:"noopener noreferrer"},k=(0,r.Uk)("https://single-spa.js.org/"),W=(0,r.Wm)("hr",null,null,-1),g={href:"https://github.com/hql7/wl-micro-frontends",target:"_blank",rel:"noopener noreferrer"},q=(0,r.Uk)("https://github.com/hql7/wl-micro-frontends"),_={href:"http://mfe.wlui.com.cn/",target:"_blank",rel:"noopener noreferrer"},E=(0,r.Uk)("http://mfe.wlui.com.cn/"),j=(0,r.Wm)("hr",null,null,-1),U=(0,r.Wm)("h4",{id:"实践参考链接"},[(0,r.Wm)("a",{class:"header-anchor",href:"#实践参考链接"},"#"),(0,r.Uk)(" 实践参考链接")],-1),w={href:"https://juejin.im/post/6844904185910018062",target:"_blank",rel:"noopener noreferrer"},M=(0,r.Uk)("https://juejin.im/post/6844904185910018062"),v={href:"https://juejin.im/post/6856569463950639117",target:"_blank",rel:"noopener noreferrer"},B=(0,r.Uk)("https://juejin.im/post/6856569463950639117"),x={href:"https://juejin.im/post/6844904085200601102",target:"_blank",rel:"noopener noreferrer"},y=(0,r.Uk)("https://juejin.im/post/6844904085200601102"),A=(0,r.Wm)("h4",{id:"已有的实践"},[(0,r.Wm)("a",{class:"header-anchor",href:"#已有的实践"},"#"),(0,r.Uk)(" 已有的实践")],-1),z={href:"https://mp.weixin.qq.com/s/DpFXTrQ3_kBX4EB6or4Q8Q",target:"_blank",rel:"noopener noreferrer"},D=(0,r.Uk)("用微前端的方式搭建类单页应用"),F={href:"https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&mid=2651751390&idx=1&sn=f65a2da16483644197b8e8b166c002c9&chksm=bd125a938a65d3850b9f3bfe922ec0f94425775263e35f606917127b278a0a08a9a858992cf5&mpshare=1&scene=1&srcid=0910Fxc2P8tFEWN9BT5D24sU&sharer_sharetime=1599700596729&sharer_shareid=692a5910b346e9d14f71dd5fad4e1f0c&key=e964651f49811b3ae3d1a39423d393f7fe87c9d16c5eb39ad5f75e2059ad58170b15bd0d8d000c38b7f9b487d94c044b496b7e4dc20147d71c50a769e198445d030d56113b7b9bd4dacf82de905dce79d6254b1eed934664b49ae177f0a41a864dc51274947de8c98174424c0f901ed961dcc7c9862fb66ebf94b180d47e2034&ascene=1&uin=MTIzMzMwMTAwMA%3D%3D&devicetype=Windows+10+x64&version=62090529&lang=zh_CN&exportkey=AVvuvdOhQ%2Ff8oTix%2BXVSUqw%3D&pass_ticket=OSIE2kB9QW6ZvPtyKkyObVXUtoh3V46DNw%2F2j7E%2BWqknF%2F%2BNLMvGiGsM8rygJq%2FE&wx_header=0",target:"_blank",rel:"noopener noreferrer"},O=(0,r.Uk)("微前端在美团的实现"),N={href:"https://mp.weixin.qq.com/s?__biz=MzI1MzYzMjE0MQ==&mid=2247485444&idx=1&sn=62b872dac1c7ef15305b0eca4f01c8e0&chksm=e9d0c3e6dea74af0331d908a46821ae601146c14178fa9abbea384196aed034aaab2541be816&mpshare=1&scene=1&srcid=0910H4VDpUe9fdvOeti0MhMw&sharer_sharetime=1599700805938&sharer_shareid=692a5910b346e9d14f71dd5fad4e1f0c&key=8bc8ac599537b085fa50ebe8c09b6e060f254f552b5bedf3e9ed7bb91f32aead8f6d699c46f11bf83edfa69916830a503ba5060c063f01d9545cc3dcb3bc5a806b6f3d4af5d8706fde0ba5cd51b0a1e416c96ff838e30edee57892cd7b975109930a74afa23fabb0cee19c9aefff576563775bbaf098b334a64acd52d82099c6&ascene=1&uin=MTIzMzMwMTAwMA%3D%3D&devicetype=Windows+10+x64&version=62090529&lang=zh_CN&exportkey=AYyHcjHJ5GVN3K3AjHPBkKw%3D&pass_ticket=OSIE2kB9QW6ZvPtyKkyObVXUtoh3V46DNw%2F2j7E%2BWqknF%2F%2BNLMvGiGsM8rygJq%2FE&wx_header=0",target:"_blank",rel:"noopener noreferrer"},T=(0,r.Uk)("字节跳动微前端实践"),V={href:"https://xiaomi-info.github.io/2020/04/14/fe-microfrontends-practice/",target:"_blank",rel:"noopener noreferrer"},I=(0,r.Uk)("微前端在小米 CRM 系统的实践"),P={href:"https://developer.aliyun.com/article/755067",target:"_blank",rel:"noopener noreferrer"},Q=(0,r.Uk)("飞猪微前端实践：统一运营工作台的解决方案"),S=(0,r.uE)('<h2 id="拆分项目"><a class="header-anchor" href="#拆分项目">#</a> 拆分项目</h2><p>整合数据中台 + lanjing中台</p><ol><li><p>导航菜单整合到main应用</p><blockquote><p>路由分发应用，再有应用分发路由</p><p>统一权限管理</p></blockquote></li><li><p>sub-app判断qiankun环境，是否展示自身的菜单(保证子项目单独发布也能正常运行和展示)</p></li><li><p>数据的传递</p><ol><li>url传参</li><li>Vuex</li><li>qiankun中的globalState</li></ol></li><li><p>SSO 单点登录</p></li><li><p>sub-app有统一的界面风格管理，可以方便调整风格到main-app的风格上</p></li></ol><h4 id="要点"><a class="header-anchor" href="#要点">#</a> 要点</h4><p>主应用只是一个包含导航栏和鉴权功能的容器</p><ul><li><p>构建主应用</p><blockquote><p>SSO单点登录实现，主应用维护一套路由导航菜单，统一鉴权和登录页。需要服务端配合提供针对&quot;聚合APP&quot;的鉴权接口点击导航菜单跳转到各个子应用具体路由页</p></blockquote></li><li><p>子应用</p><blockquote><p>兼容微前端架构，当作为子应用时，需要调整为：</p><ul><li>不展示菜单栏 + 面包屑，状态栏等</li><li>隐藏子应用登录页，登录跳转到主应用登录页</li><li>调整子应用视觉主题兼容主应用</li><li>控制台菜单使用主应用的，子应用路由跳转后，仅提供内容区</li></ul></blockquote></li></ul><p>这样看，子应用为了兼容主应用，会做不少代码调整</p><h4 id="中台模块拆解"><a class="header-anchor" href="#中台模块拆解">#</a> 中台模块拆解</h4><ul><li><p>主应用(portal-app 或 main-app)</p><blockquote><p>登录鉴权功能</p><ul><li>登录页面</li><li>提供个人信息展示页(登出，修改个人信息等功能)</li><li>提供路由异常页面(403,404 page)</li></ul><p>提供可访问的菜单</p><pre><code>- 主应用组织菜单展示形式\n</code></pre></blockquote></li></ul><p><img src="https://fun-typora-pics.oss-cn-beijing.aliyuncs.com/imgplatform-microfront.png" alt=""></p><ul><li><p>子应用</p><blockquote><p>技术栈无关，研发开发一个独立的app或者模块</p><ul><li>独立部署，独立运行(UI层面兼容)</li><li>作为子应用被集成</li></ul></blockquote><p>为了兼具独立运行展示和被集成的效果，其应该拥有自己的菜单路由跳转逻辑，同时，在作为子应用时，隐藏掉展示层面的菜单。</p></li></ul><h4 id="样式风格的统一"><a class="header-anchor" href="#样式风格的统一">#</a> 样式风格的统一</h4><p>编码上，由于组件整体采用ant-design-vue，所以自定义的组件颜色也通过less设置为antd中提供的变量颜色。这样后续，就可以通过动态改antd的主题，达到页面整体风格的切换</p><h4 id="独立部署与运行docker联调"><a class="header-anchor" href="#独立部署与运行docker联调">#</a> 独立部署与运行docker联调</h4><ul><li><p>不同子应用如何通讯</p><blockquote><p>把关联的项目，通讯较多的，归到一个子应用中，变成应用内通信</p><p>真正去做一次应用间通信</p></blockquote></li></ul><h4 id="实践问题处理"><a class="header-anchor" href="#实践问题处理">#</a> 实践问题处理</h4>',16),C=(0,r.uE)('<li><p>子项目中引入<code>assets</code>下的资源</p><blockquote><p>import logoUrl from &quot;@/assets/logo.png&quot;</p></blockquote><ol start="2"><li><p>注销账号，登录页样式显示异常</p><p>分析：当token有效时，默认打开的是dashboard页，即此时未把登录相关页面挂载。注销切换到登录页时，由于登录页路由懒加载，导致样式未加载完成就展示？？</p></li><li><p>子应用挂载失败，找不到挂载的节点</p><blockquote><p>一般是子应用页面逻辑有问题导致的</p></blockquote></li></ol></li>',1),G=(0,r.Wm)("p",null,"父子应用中不同的请求url问题，子应用多个baseurl如何处理",-1),H={href:"https://github.com/umijs/qiankun/issues/315",target:"_blank",rel:"noopener noreferrer"},X=(0,r.Uk)("https://github.com/umijs/qiankun/issues/315"),K=(0,r.Wm)("p",null,"解决方式：",-1),J=(0,r.Wm)("ol",null,[(0,r.Wm)("li",null,"开发环境，在主应用配置代理，把所有子应用的接口代理地址都配上"),(0,r.Wm)("li",null,"生产环境，通过nginx进行转发")],-1),L={render:function(e,l){const a=(0,r.up)("OutboundLink");return(0,r.wg)(),(0,r.j4)(r.HY,null,[n,(0,r.Wm)("p",null,[t,(0,r.Wm)("a",i,[o,(0,r.Wm)(a)])]),p,c,h,s,(0,r.Wm)("p",null,[(0,r.Wm)("a",u,[d,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",m,[f,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",b,[k,(0,r.Wm)(a)])]),W,(0,r.Wm)("p",null,[(0,r.Wm)("a",g,[q,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",_,[E,(0,r.Wm)(a)])]),j,U,(0,r.Wm)("p",null,[(0,r.Wm)("a",w,[M,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",v,[B,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",x,[y,(0,r.Wm)(a)])]),A,(0,r.Wm)("p",null,[(0,r.Wm)("a",z,[D,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",F,[O,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",N,[T,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",V,[I,(0,r.Wm)(a)])]),(0,r.Wm)("p",null,[(0,r.Wm)("a",P,[Q,(0,r.Wm)(a)])]),S,(0,r.Wm)("ol",null,[C,(0,r.Wm)("li",null,[G,(0,r.Wm)("blockquote",null,[(0,r.Wm)("p",null,[(0,r.Wm)("a",H,[X,(0,r.Wm)(a)])]),K,J])])])],64)}}}}]);