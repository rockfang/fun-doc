(self.webpackChunkfun_doc=self.webpackChunkfun_doc||[]).push([[5464],{2789:(n,a,s)=>{"use strict";s.r(a),s.d(a,{data:()=>t});const t={key:"v-a29769a0",path:"/android/android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6.html",title:"ANDROID-事件分发机制",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"事件的类型",slug:"事件的类型",children:[]},{level:2,title:"事件序列",slug:"事件序列",children:[]},{level:2,title:"事件分发的对象",slug:"事件分发的对象",children:[]},{level:2,title:"事件分发的主要方法",slug:"事件分发的主要方法",children:[]},{level:2,title:"追踪源码",slug:"追踪源码",children:[]},{level:2,title:"事件分发完整模型",slug:"事件分发完整模型",children:[]}],filePathRelative:"android/android事件分发机制.md",git:{updatedTime:162452411e4,contributors:[{name:"caifang",email:"cooldish1245@163.com",commits:1}]}}},9521:(n,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>e});const t=(0,s(6252).uE)('<h1 id="android-事件分发机制"><a class="header-anchor" href="#android-事件分发机制">#</a> ANDROID-事件分发机制</h1><p>追踪源码，理解android的事件分发机制。</p><h2 id="事件的类型"><a class="header-anchor" href="#事件的类型">#</a> 事件的类型</h2><p>用户触摸屏幕产生的触摸类型(Touch事件)</p><ul><li>MotionEvent.ACTION_DOWN 手指刚接触屏幕</li><li>MotionEvent.ACTION_MOVE 手指从屏幕上松开</li><li>MotionEvent.ACTION_UP 手指在屏幕上滑动</li><li>MotionEvent.ACTION_CANCEL 非人为因素取消</li></ul><h2 id="事件序列"><a class="header-anchor" href="#事件序列">#</a> 事件序列</h2><p>一次手指触摸屏幕的行为会触发的一系列点击事件</p><ol><li><p>点击屏幕后立即松开，事件序列为DOWN -&gt; UP</p></li><li><p>点击屏幕后滑动一会再松开，事件序列为DOWN -&gt; MOVE -&gt; …-&gt;MOVE -&gt; UP</p></li></ol><p>事件序列</p><p><img src="https://api.icaifun.com/articleImages/1588744487958.png" alt=""></p><h2 id="事件分发的对象"><a class="header-anchor" href="#事件分发的对象">#</a> 事件分发的对象</h2><ul><li>Activity:控制生命周期&amp;处理事件</li><li>ViewGroup: 一组View的结合(含多个View)</li><li>View:所有UI组件的基类</li></ul><h2 id="事件分发的主要方法"><a class="header-anchor" href="#事件分发的主要方法">#</a> 事件分发的主要方法</h2><ul><li>dispatchTouchEvent(MotionEvent ev): 用来进行事件分发</li><li>onInterceptTouchEvent(MotionEvent ev): 判断是否拦截事件(仅存于ViewGroup中)</li><li>onTouchEvent(MotionEvent ev):处理点击事件</li></ul><h2 id="追踪源码"><a class="header-anchor" href="#追踪源码">#</a> 追踪源码</h2><p>事件开始，会首先调用Activity的事件分发方法dispatchTouchEvent</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">onUserInteraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">superDispatchTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>追踪superDispatchTouchEvent，具体如图：(不忍直视的笔法，第一次ipad上作图) <img src="https://api.icaifun.com/articleImages/1588745892073.jpg" alt=""></p><p>追踪View中dispatchTouchEvent <img src="https://api.icaifun.com/articleImages/1588746411174.png" alt=""></p><h2 id="事件分发完整模型"><a class="header-anchor" href="#事件分发完整模型">#</a> 事件分发完整模型</h2><p><img src="https://api.icaifun.com/articleImages/1588746611861.png" alt=""></p>',21),e={render:function(n,a){return t}}}}]);